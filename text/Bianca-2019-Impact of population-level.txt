lesion segmentation with BIANCAof populationlevel featuresclassication algorithm and locally adaptive thresholdingb,cdg,.f,haWellcomeforforMRI of theeldofofUK bOxfordNottinghamforinofUK cOxfordforofUK dCentre forofandeldofofUK eNufﬁeldofofUK fDepartment ofofUK gNewhWellcomeforNeuroImagingofUK iDepartment ofandofARTICLE INFOmatter hyperintensitiesStructural MRILesion probability mapThresholdingMachine learningsegmentationABSTRACTmatter hyperintensities or white matter lesions exhibit high variability in their characteristics both at population and subjectlevelmaking their detection challenging task.factors such as age,vascular risk factors and neurodegenerative diseases affect lesion load and spatial distribution.the individual levelWMH vary in contrastamount and distribution in different white matter regions.this workwe aimed to improve BIANCAthe FSL tool for WMH segmentationin order to better deal with these sources of variability.worked on two stages of BIANCA by improving the lesion probability map estimation and making the lesion probability map thresholding stage automated and adaptive to local lesion probabilities.in order to take into account the effect of populationlevel factorswe included populationlevel lesion probabilitiesmodelled with respect to parametric factor in the classication stage.we tested BIANCA performance when using four alternative classiers commonly used in the literature with respect toneighbour algorithmcurrently used for lesion probability map estimation in BIANCA).we propose LOCallysupervised method fordetermining optimal local thresholds to apply to the estimated lesion probability mapas an alternative option to global thresholding.these experiments we used data from neurodegenerative cohortvascular cohort and the cohorts available publicly as part of asegmentation challenge.observed that including populationlevel parametric lesion probabilities with respect to age and using alternative machine learning techniques provided negligible improvement.LOCATE provided sub stantial improvement in the lesion segmentation performancewhen compared to the global thresholding.to detect more deep lesions and provided better segmentation of periventricular lesion boundariesdespite the differences in the lesion spatial distribution and load across datasets.further validated LOCATE on cohort of CADASIL patientsgenetic form of cerebral small vessel diseaseand healthy controlsshowing that LOCATE adapts well to wide variations in lesion load and spatial distribution.forforMRI of theeldofsciencesofUK.is an open access article under the CC BY license.matter hyperintensities of presumed vascular originWMHalso known as white matter lesionset al.are common radiological abnormalities often associated with cognitive impairment and one of the main signs of cerebral small vessel disease.despite their assumed clinical importance based on their spatial locationet al.et al

accurate automated detection of WMH is very challenging due to the high variability of their characteristics both between and withinsubjects.exampleat the populationlevelthe amount and distribution of white matter lesions have been associated with various factors such as cognitionvascular risk factors and neurodegenerative diseases.WMH also occur more commonly at older ageet al.the subjectlevelgenerally WMH exhibit spatial heterogeneity and do not appear with the same contrast in all regions of the brain on structural MRI images.exampletypicallyperiventricular WMH are brighter on T2weightedFLAIR or proton density images and bigger compared to deep ones and hence can be detected more easily.variability in lesion characteristics can affect the performance of supervised lesion segmentation methods at different stages.esti mation of the probability for each voxel to be lesionlesion probability mapis affected by populationlevel factorssuch as agecognitionvascular risk factors and pathological conditionset al.et al.and lesion loadet al.lesion probability map is generatedthe choice of the threshold used to obtain binary maps is affected by lesion load and the variation in local intensities.factheterogeneity in signal intensity affects lesion probability values determined by segmentation algorithms since brighter lesions are typically assigned higher probabilities than those with lower contrast.makes it difcult to determine the optimal threshold for obtaining thenal binary lesion maps.factapplying global thresholdi.the same threshold to all the voxels of the lesion probability maptypically results either in the exclusion of deep lesions or overestimation of peri ventricular lesions.often results in tradeoff between sensitivity and specicity of lesion detection.alternative proposed byet al.consists of determining thresholds based onscore or by visual inspection of individual subjects.these thresholds would also be global and determining them would require manual intervention.this workour objective is to improve our recently developed WMH segmentation methodAbNormalitycationrithm to overcome population and subjectlevel variability in the lesion characteristics.aim to achieve this by systematically exploring ways of improving various stages of the lesion probability map estimationand also by developing method for thresholding that takes into account spatial variability of lesion proba bility map

the estimation of lesion probability mapwe tested the inclusion of populationlevel lesion probabilities with respect to para metric factor and explored the performance of alter native machine learning methods.way to include populationlevel probabilities is to obtain the distribution of lesions within population with respect to parametric factor and use it in BIANCA as either spatial prior or an additional feature in the WMH segmentation.this workwe modelled the spatial distribution of lesions within population with respect to age to obtain apopulationlevel parametric lesion probability map as described in our previous study and explored whether the information provided by the PPLPM could improve the results orconverselyintroduce bias towards the expected distributionrefer toof populationlevel parametric lesion probability mapand corresponding results).the alternative machine learning techniqueswe explored four other supervised classiers used in the existing literature and compared their segmentation results with those obtained from the existingneighbour classication algorithm in BIANCArefer toof alternative classiers within BIANCA and results).networks support vector machines and adaboost classier have been already used for WMH segmentationwhile random forests have been used for the segmentation of various structures and pathological signs that have similar characteristics as WMH on structural MR imageset al.to improve the thresholding stagewe propose LOCATE supervised method to determine optimal local thresholds for binarising the subjectlevel lesion probability map to take into account the spatial heterogeneity in lesion probabilities.LOCATE is guided by local probability values and exploits different lesion characteristics to determine local thresholds.this work we present LOCATE with specic applicability to BIANCAhoweverin principle LOCATE can be applied to the lesion probability map obtained by any methodprovided the availability of training data with manual lesion masks.evaluated LOCATE on various clinical datasetsneurodegenerative cohort and vascular cohortand publicly available WMH segmentation challenge datasetto observe the performance of LOCATE on data acquired under different protocolsand later applied it on two additional datasets to further explore the potential of LOCATE toprovide relevant local thresholds for different lesion loadsdistribution and patternsrefer toLOCallyand corresponding results).shows the block diagram describing the strategies explored for improving BIANCA performance.this work we usedve datasets to study the effect of variations in lesion characteristics on the WMH segmentation.datasets are diverse in terms of populationand therefore WMH load and characteristics.neurodegenerative cohortis subset of the same dataset we used in our previous work to optimise BIANCA subjects with manual lesion segmentation available lesion load rangemmmedianmm.ythe dataset includes MRI data from subjects with probableswith amnestic mild cognitive impairment and cognitively healthy control subjects recruited from the OPTIMA study and from theat theinage range yearsmean age.MRI images were acquired at theofOCMR centre onscanner using T2weighteduid attenuated inversion recovery research sequenceTR/TE msip angle FOV mmmatrix sizeCvoxel size mmand highresolution T1weighted images were also acquiredTR/TE.vascular cohortvascular studydataset consists of consecutive eligible participants in the OXVASC study who had recently experienced minor nondisabling stroke or transient ischemic attackage range yearsmean age.NeuroImagebrain volume rangemmmedianmm.was performed at theonscanner using T2weightedFLAIR sequenceTR/TE msip angle FOV mmmatrix sizeCvoxel size mmand high resolution T1weighted sequenceD MPRAGE sequenceTR/TE.lesion segmentation was available for all imageslesion load rangemmmedianmm.cerebral autosomal dominant arteriopathy with subcortical infarcts and leukoencephalopathy cohortdataset consists of patients with CADASILage range yearsmean age

CADASIL is genetic form of small vessel disease caused by mutations within the NOTCHgene.is the most common heritable cause of stroke and vascular de mentia in adults and it is characterised by extensive damage to white matter brain regions.patients are younger than those with sporadic SVDwithout confounding factors of coexistent neurodegenerative pathology.there fore provide model of pure SVD in which to investigate WMHet al.was performed using the same scanner and acquisition parameters as the OXVASC dataset.segmentation was not available for this dataset.healthy controlsdataset consists of healthy controlsagematched with the CADASIL subjects with age range yearsmean age.ning was performed using the same scanner and acquisition parameters as datasets and.segmentation was not available for this dataset.nlUMCNUHSTrioTimVUGEHDxt.segmentations are available for all three datasetswith an additional exclusion labelprovided for other pathology.the challengethese masks with exclu sion labels were ignored during performance evaluation.we included these masks as parts of nonlesion tissueduring the calculation of the performance metricsfor more stringent evaluation in the pres ence of pathologies.WMH volume rangesexcluding other pathol ogiesare mmfor UMCmmfor NUHSand mmfor VUand the brain volumes are mmfor UMCmmfor NUHSand mmfor VU.in the challenge the performance metrics were calculated on independent un seen test datasets.we did not participate in the challengewe used publicly available training datasets for evaluationusing leaveoneout cross validation.our results are not directly comparable with those published after the outcome of the challengeas they are not relative to the unseen test data used in the challenge.preprocessingskull stripped the images using FSL BET followed by biaseld correction using FSL FAST.images in datasetswere preprocessed as described inet al.to extract mean diffusivity mapused as additional intensity feature

registered the image modalities to the base modalityin our caseFLAIR for all datasetsusing linear rigidbody registration with FSL FLIRTand.also calculated the transformation between the subjects native space and the MNI spacerequired by BIANCA for determining spatial features.all the experiments presented in this work we used linear registrationcalculated with FSL FLIRTfor esti mating MNI coordinates as spatial features.we also tested the effect of using nonlinear registrationobtaining negligible change in BIANCA performance.BIANCA features and training optionsdefault options in BIANCA arespatial weightingno patchlocation of training pointsany location for nonWMH training pointsnumber of training pointsFixedequal with training points.more details regarding the BIANCA optionsreferet al.NDGENwe used FLAIRTas features.than the default optionswe used the following nondefault optionslocation of training pointsno bordernumber of training pointsFixedþunbalanced with.diagram showing the three strategies explored for improving BIANCA performance.red highlighted blocks indicate the steps we focused on in this work.NeuroImage lesion points and nonlesion points.OXVASC we used FLAIRTMD as features.nondefault options used wereswD patch with patch size of.CADASIL and HCwe used the same features and BIANCA options used for OXVASC except spatial weighting.excluded spatial features by setting swfor these two datasets.MWSC datasetwe trained BIANCA separately on the three datasets using the same features and BIANCA options used for NDGEN.of populationlevel parametric lesion probability mapparametric lesion probability maps describe the pattern of lesion distribution with respect to specic parametric factor.they could provide useful additional in formation to improve lesion segmentation.our experiments in this workwe considered age as our parametric factor of interestsince clear relationship has been established between age and WMH distribution.modelled the PPLPM with respect to age within population consisting of subjectsas described in our previous worket al

yourspline model takes binary lesion maps of individual subjects of the population as inputs and generatesD parametric lesion probability mapwith agegrouped at intervals of yearsalong theth dimension.resulting parametric lesion proba bility map indicates the probability of lesion occurrence at specic age group at each voxel.shows the PPLPM at two example age groupscorresponding to years and years.used the PPLPM in BIANCA in two wayseither as an additional feature to the KNN classieror postmultiplying the PPLPM with the subjects lesion probability map that is obtained using BIANCA with existing features.therst experimentwe implemented the PPLPM in BIANCA as followswe included the PPLPMaD volume in the MNI space with thethdimension representing different age groupsas an additional inputwe included age as an extra input in BIANCA and used it to select the appropriateD map from the PPLPM corresponding to the speciﬁc age group and we transformed theD map from the MNI space to the subjects native space nonlinearly using FSL FNIRT before extracting its probability values as fea tures to be used by the KNN classier.the second experimentwe multiplied the agespecicD map from PPLPMtransformed to the subjects native spacewith lesion probability map obtained from BIANCA.also tested the effect of the averageD map across all age groups instead of the agespecic one.performed both experiments on the NDGEN datasetkeeping all the other options constantas optimised inet al.andspeciﬁed in section BIANCA features and training optionsand evaluated the performance with respect to the manual masks as described in sectionevaluation metrics.of alternative classiers within BIANCABIANCA is based on the KNN algorithm.this work we assessed the performance of four other classiersrandom forest neural networks support vector machine and adaboost.we optimised the parameters for each classier based on the area under the curve values from ROC curvesand then compared their results with KNN.provides the list of available parametersfrom the python scikitlearn packageand the parameters that were considered for tuning in the optimisation step.initial parameter tuningwe selected four subjects from the NDGEN dataset with four different lesion loadslowmediumhigh and very high.optimi sationwe applied the four classiers on the remaining subjects from the NDGEN datasetkeeping all the other options constantas specied in section BIANCA features and training options and evaluated the perfor mance with respect to the manual masks as specied in section.lesion probability maps at two example points in the para metric dimensioncorresponding to two age groupsall the images are shown at in MNI spacein the younger age group the lesion probability is very low throughout the brainwhile in the older age group the lesion probability is higherespecially in the periven tricular regions.considered for tuning different classiers.ermain parameters and default valuesValues of parameters considered for tuningforestNo.of treesfor splitting MSEMaximum depth of treesthe leavesare pureMinimum no.of samples required for asplitMinimum samples at each leaf nodenumber of features for each tree

of featuresMinimum impurity measure at each split doneerror score FalseNo.of treessamples at each leaf node impuritymeasure at each splitdepth of treesnetworkNo.of neurons in hidden layerfunction RELUOutput activation function LogisticsigmoidSolver ADAMdropout LregularizationCin learning ratelearning rate no.of iterations.of neurons in hidden layer LBFGSADAMInitial learning rateCno.of iterationsvector machineType of kernelbasis function.of iterations Untilconvergenceγ.ofiterationsclassierestimator.of trees in base estimatorNo.of estimatorsrate.of trees in base estimatorNo.of estimatorsrate.NeuroImagePerformance evaluation metrics.order to test the consistency of the re sults across various cohortswe tested the performance of the best per forming alternative classiers in the three cohorts from MWSC dataset.LOCallyorder to overcome the impact of spatial heterogeneity of lesion probabilities due to changes in lesion contrastload and distribution on theﬁnal thresholded WMH mapwe propose method that determines spatially adaptive thresholds at different regions of the lesion probability map.LOCATE takes as input the subjectlevel lesion probability map obtained from lesion segmen tation algorithmin our caseBIANCA run with the options specied in section BIANCA features and training options and estimates local thresh olds in three steps by dividing the lesion probability map into subregions extracting local characteristics within those subregions and estimating the optimal local threshold values based on the extracted features using supervised learning method.tessellation and feature extractionwe detected local maxima pointswhere ithe lesion probability map to identify the plausible lesion locations.order to avoid spurious local maxima points due to isolated voxelswe applied small amount of spatial smoothing to the lesion probability map withlterprior to local maxima detection.FWHM size of thekernel was empirically chosen to be.then tessellated the lesion probability map based on local maximaNVoronoi polygonsaround the maxima

order to ensure that ourpolygons are within the region of interestin our casethe brain white matterwe constrained thepolygons within white matter mask obtained from dilated and inverted CSF tissue segmentationcombined with other deep grey exclusion masksas described inet al.eachpolygonwe applied different levels of thresholds from to.greyscale intensity of the image used to identify the lesionsin our caseFLAIRwithin the thresholded region.between the ventricles and the centre of gravity of the thresholded region.ventricles were segmented from Tim ages as described inet al.and the distance from the ventricle mask was calculated using the FSL command distancemap).of the thresholded region.of subjects with different WMH lesion loads used for parameter tuning of the classierslowmediumhigh and very high lesion load.manually segmented lesion volumes for lowmediumhigh and very high lesion loads are mmmmmm3and mm3respectively.LOCally.FLAIR imagedetection of local maxima on the smoothed lesion probability mapspaceslocal maxima points threshold map showing the local threshold values obtained from the regression modelhistogram of thresholdsnal binary lesion map obtained by applying the thresholds on the lesion probability map binary lesion map obtained by applying global threshold of.NeuroImageFor tessellating the lesion map into subregionswe also experimented with simple linear iterative clustering and observed that LOCATE is robust to the method used for tessellationrefer to supplementary material for experiment details and results).to lack of simple relationship between the features and the thresholds we determined the optimal local threshold for eachusing random forest regression model with trees and min leaf size of.phaseeachamong the set of thresholdsdetermined the highest valuewhich we obtained the best sim ilarity index with respect to the manually segmented binary lesion mask.then trained the random forest regression model with the above features against.phaseapplied the trained regression model to get the optimal thresholdeachthe test images.shows an instance of.that the periventricular region shows higher threshold values compared to the deep regionindicating the variation in lesion probabilities.the histogram of thresholdsobtained for an individual image shows wider range of local threshold values depending on the local lesion characteristics and spatial distribution.nal stepwe thresholded the lesion probability map within eachthe correspondingget thenal binary lesion map

LOCATE evaluation and validationinitially evaluated LOCATE using leaveoneout testing indepen dently on the NDGENOXVASC and MWSC datasets on the outputs from BIANCA obtained using features and options specied in the section BIANCA features and training options.LOCATE performance was tested against the manual segmentation and against the results obtained using the optimal global threshold using the metrics described in sectionformance evaluation metrics.order to evaluate LOCATE performance in lesions with different characteristicswe additionally calculated the performance metrics in periventricular and deep lesions separately.also performed ANOVA on the performance metrics to observe the main and interaction effects on the measures.adopted the mm distance ruleclusters within mm distance from the ventricles were considered as periventricular lesionsotherwise as deep lesions DeCarli et al.there are other criteria available for identifying deep and periventricular lesionsthe mm distance rule is more suitable for automatic implementationit is commonly used and agrees with the human ratereven in most of the conuent lesion caseset al.used CADASIL and HC datasets to further validate the robustness of LOCATE with respect to lesion load and theexibility of LOCATE with respect to the training dataset.factthey represent two very different scenarios from the datasets tested so far.subjects in the CADASILdataset have very different lesion pattern andon averagehigher lesion load than the other datasetswhile HC have negligible lesion loads.since manual segmentation was not available for these data setswe used the OXVASC dataset for trainingboth for obtaining the lesion probability map with KNN using the same features/optionsand for LOCATEsince the images were acquired using the same MRI pro tocol.output obtained with LOCATE on these datasets was qualita tively evaluated and quantitatively compared with the lesion mask obtained by applying the optimal global threshold determined with leaveoneout on the training dataset.additionon the CADASIL sub jectswe compared LOCATE output with the mask obtained by applying lower global threshold.threshold was empirically chosen by an expert neurologist as the optimal global threshold for this specic data set.this comparative analysiswe explored the possibility of using LOCATE on different cohorts and various lesion loadshaving very different optimal global threshold from the preestablished value of.by using CADASIL and HC datasetswe aimed to observe the effect of the difference in the lesion characteristics between patient group and controls on thresholds obtained from LOCATE.evaluation metricsevaluated the lesion segmentation results using the following overlap measures and detection ratescalculated asCtrue positive lesion voxels.lesion voxels refer to the lesion voxels in the manual segmentation and positive lesion voxels are the voxels labelled as lesions by the classier.used SI to generate SI plots at different thresholds and to perform paired ttests between existing BIANCA and all the options used in the experiments described in the above sections.positive rate number of true positive lesion voxels divided by the number of true lesion voxels positive rate number of false positive lesion voxels divided by the number of non lesion voxels.used TPR and FPR in order to plot ROC curves for evaluating the segmentation of existing BIANCA and all the options used in the experiments

true positive rates in deep and periventricular white matternumber of true positive lesions divided by total number of true lesionscalculated separately for deep and periventricular le sions.used this metric to evaluate the robustness of LOCATE and to perform paired ttest between the global threshold and LOCATE results.extracted from eachpolygon plotted against the threshold values for subjects from the NDGEN datasetvolume of individual le sion regionmean greyscale intensity and distance of the centre of gravity from the ventricles mask.simple straightforward relationship was no found between the features and the thresholdsindicating the need for machine learning based method.NeuroImage.of populationlevel parametric lesion probability map.shows the ROC curves and SI plots at different thresholds for our experiments using the PPLPM with respect to age on the NDGEN dataset.PPLPM as an additional feature does not improve the performance of BIANCAalthough the use of the agespecicD map still gives better results than the use of an average map across all age groups.the PPLPM is postmultiplied with the sub jects lesion probability map the TPR and SI values are very lowespecially at higher thresholds.optimal threshold for the existing version of BIANCA for this dataset was found to be.adding the agespecicD map as new featurewe still found.paired ttest showed signicantly higher SI values for existing BIANCAat the threshold of.ROC and SI curves in the case of use of PPLPM when the agespecicD map is added as an additional feature the averageD map is added as an additional feature and when agespecicD map is postmultiplied with BIANCA lesion probability map.curves corre sponding to the existing BIANCA results are shown in red for comparison in all the three cases.NeuroImage.of alternative classiers within BIANCAlists the best performing set of parameters that were obtained for each classier on the four subjects selected from the NDGEN dataset in the optimisation phasewhen we tested using the area under the curve values for all possible combinations of the parameter values listed in.shows the ROC curves and SI plots for the four classiersRFNNSVMABusing the best and the default set of parameterswith respect to KNNon the remaining subjects from the NDGEN dataset.the ROC curves and SI indicesoverall KNN performs better than other classierseven for their best set of parameters and using the optimal threshold for each classier.ttest results showed that SI values from KNN are signiﬁcantly higher than those of RFp.results were obtained on the MWSC datasetson NUHSand UMCcohorts KNN performed signicantly better than NN and ABand similar to RF

VUcohortSI values obtained using the KNN classier were not signicantly different from those obtained with all alternative classiers.more details on these results and relative plotsrefer to the supplementary material.LOCally.and illustrate examples of BIANCA results with LOCATE outputs compared to outputs with global threshold and the manual segmentation in various datasets.LOCATE detected more deep lesions and segmented peri ventricular lesions better with respect to the manual segmentation.additional lesions detected by LOCATE with respect to manual segmentation inbcdid not represent false posi tives as they were labelled as lesions by the manual segmentation in adjacent slices.MWSC datasets LOCATE segments the lesions in the temporal regions with better accuracy compared to global thresholdwhich misses few welldened lesions in that region.shows the ROC curves and SI plots for BIANCA at various global thresholds and using LOCATE for NDGENOXVASC and MWSC datasets.SI values obtained with LOCATE were not signicantly different according to the paired ttest to those obtained with global thresholding values of.in terms of detection ratesLOCATE gave an increase in voxelwise TPR.case of the MWSCthe voxelwise TPR showed negligible difference between LOCATE and global thresholding resultsdespite small increase in FPR.is worth noting that for MWSC datasetswe obtained the above results on the publicly available training datasets while in the challenge the evalu ation was done on the held out test dataset and hence the performance of our method could change depending on the dataset characteristics.shows the clusterwise TPR plots for NDGENOXVASC and cohorts of MWSC respectively.performedway repeated measures ANOVA considering region and method as independent factors and clusterwise TPR as the dependent measure.determined the main effect of region and methodalong with the effect of their interactionon clusterwise TPR values.reports the descriptive statistics and ANOVA results for comparison of clusterwise TPR values.observed signiﬁcant main effect of method for all datasetswith clusterwise TPR always higher for LOCATE than global thresholding.main effect of region was signicant only for MWSC cohortsclusterwise TPR was not signiﬁcantly different between periventricular and deep regions in NDGEN and OXVASCwhile it was signicantly higher in periventricular than deep regions for MWSC cohorts.these cohorts we also observed asigniﬁcant interaction effectthe increase in clusterwise TPR using LOCATE with respect to global threshold was higher in the deep regions compared to periventricular regions.the similar comparative analysis and ANOVA results on other measures such as TPRFPR and SI values for the above datasetsrefer to the supplementary material

illustrates the results of lesion segmentation by applying LOCATE on the CADASIL dataset.CADASIL patients have different lesion characteristics compared to those in the OXVASC datasetdifferent lesion location and very high lesion loadsapplying the global threshold of.global threshold visually determined as optimal was.LOCATE provides much better segmentation and detects the lesions in the temporal lobetypical of the pathology.similar comparison of LOCATE results with those of global thresholding at.the binary lesion maps obtained using the optimal global threshold value of.CADASILusing LOCATE increases the voxelwise TPR by.BlandAltman plots in.show the agreement in lesion volumes for global threshold and LOCATE with respect to the reference segmentation for the above datasets.thegureit can be seen that there is not much scope for improvement in NDGEN and VUhowever LOCATE shows improvement for OXVASCNUHSand UMCboth in terms of slope and limits of agreement.summarise the effect of LOCATE on different datasets,.shows boxplots of local threshold values determined by LOCATE for theve datasets along with the optimal global threshold values for each dataset.median threshold values of NDGENMWSC and HC datasets are higher thanother two datasetsespecially the CADASIL dataset.LOCATE assigned higher thresholds for datasets with lower lesion loadHC and NDGENwhich contains of healthy subjectsand lower thresholds for data sets with higher lesion load.is also observable from the thresholded maps shown in.performing set of parameters for different classiers.erperforming set of parametersforest.of trees.samples at each leaf node.impurity measure at each split

depth of treesnetwork.of neurons in hidden layerLBFGSlearning rate.of iterationsvector machine.of iterationsclassier.of trees in base estimator.of estimatorsrate.NeuroImageFig.ROC curves and SI curves for alternative classiersrandom forest neural network support vector machine and adaboost classier.are shown for each classier’s best and default parameters along with the results for KNN classiercurrently used in BIANCA.NeuroImageInterestinglythe medians of LOCATE thresholds for the OXVASC and CADASIL datasets are also quite different from their corresponding optimal global thresholds and the ranges of thresholds obtained from LOCATE are wider when compared to the other datasets.could be due to the different sequence characteristicse.lower resolutionand pathological characteristicshigh amount of small vessel diseaseof both these datasets with respect to the others.line with the results of the paired ttestthe largest improvement in SI corresponds to the largest difference between the LOCATE threshold and the global threshold.the case of the HC datasetthe median of local thresholds obtained from LOCATE is very close to the optimal threshold of.is also evident from.where LOCATE results appear very similar to the results of global thresholding at.this workwe studied the effect of singlesubject and population level heterogeneity in amountlocation and characteristics of WMH onthe performance of BIANCAwith the aim of improving both the classication and the thresholding steps.the classication stepwe analysed the effect on the subjectlevel lesion probability maps of usingpopulationlevel lesion probability mapPPLPMwith age as factor of interestand of using alternative classierswhich have been previously used for this task in the literature.thresholding the lesion probability mapas an alternative to selecting global thresholdwe proposed LOCATEmethod to determine local thresholds that are sensitive to spatial differences in the lesion probabilitiesgiving more accurate binary lesion masks.observed the effect of using the PPLPM and found that post multiplying the agespecicD map with the lesion probability map performs worse than adding the PPLPM as an additional feature

is because PPLPM indicates the likelihood ofnding lesion at given location in populationinformed primarily by the anatomy of disease signs.the other handthe subjectlevel probability map reects the probability of identifying lesion versus the normal tissue and is pri marily determined by the intensity contrasts and noise in the image.instancein our previous work we showed that in PPLPM the lesion probabilities typically increase more in the peri ventricular WM than in the deep WM in the elder populationwhich is in line with the existing literatureet al.et al.postmultiplying the PPLPM with the subjectlevel lesion probability map can bias the subjectlevel lesion probabilities more towards the periventricular lesionsirrespective of the local spatial characteristics in the images from the individual subject.results of LOCATE for lowmediumhigh and very high lesion load.segmentation is shown along with outputs of global thresholding at.LOCATE provides better segmentatio in deep and periventricular white matter lesions when compared to global thresholding.NeuroImage when we provide the PPLPM as an additional featurethe classier assigns sensible lesion probability values taking into account the PPLPM as well as the image intensity contrasts for the different modalities and the spatial coordinates.we observed that adding agespecic map as an additional feature gives better results than the average mapsince the former models the lesion probabilities for the subjects age group specically and hence is more accurate.we observed thatat presentusing the PPLPM does not improve signicantly the performance of BIANCAalso evident from the pvalues of our ttest results).our current recommendation is that PPLPMwith age as parameter of interestis not necessary for improving BIANCA segmentation.the way this option will be implemented in future release of BIANCA is quiteexible and will allow the user to use anyD PPLPM with respect to any other factor of interestwhich could improve the segmentation in their specic dataset.it is worth noting that before using this optionthe user needs to ensure if the demographics of the test dataset are comparable to those of the population used to model the PPLPM.results on the comparison between KNN and other classiers showed that KNN provided better segmentation.the same set of features we observed that SVM and AB classiers provided signicantly lower SI than KNNespecially at higher thresholds.the other handSI values for RF and NN followed similar trend to KNN with relatively similar SI values.the NDGEN datasetSI values for RF were still signicantly lower than KNNwhile NN gave SI values that were not signicantly different from KNN.the MWSC datasetSI values obtained using KNN did not differ signicantly from those of RF in all cohorts and from those of NN in the VUcohort.for given FPRKNN has higher TPR compared to any other classier,indicating that KNN detects more true lesions than other classiers

since NN and RF have the potential to perform as well as KNNthey will be included as alternative classiers in future release of BIANCA.this pointit is worth noting that irrespective of the classier usedthere is certain degree of uncertainty associated with the manual segmentation they are an approximation to the real ground truthmeaning that veryne discrimination may reect errors in the manual segmentation rather than errors in the automated classication results.the improvements at the thresholding step with LOCATEthe initial leaveonesubjectout results of LOCATE on NDGENOXVASC and MWSC datasets showed improvement in BIANCA segmentation for all datasets.LOCATE detected more true positive lesionsespecially in the deep white matterand provided better delineation of the lesions with respect to the manual segmentation as indicated by the improved SI values and the visual results shown in.BIANCA is currently not optimised for segmentation of corticalcerebellar and subcortical lesionswe could not further evaluate LOCATE perfor mance in these areassince they are not included in BIANCA output.LOCATE provided results comparable with global thresholdirre spective of changes in the acquisition protocols and image characteristics in MWSC dataset.ranking methods for MICCAI WMH segmentation challenge are based onandet al.et al.and modied location sensitive deep convolutional neural network.nlincluding SI values and clusterwise true positive rateof individual lesions).achieved an average SI value of.we achieved clusterwise true positive rate of.results of BIANCA with locate and global thresholding compared to the manual segmentation.corresponding thre shold maps are shown in redyellow.NeuroImage.of ROC curvesSI plots for LOCATE and global thresholding.ROC curves SI indices for NDGENOXVASC and MWSCVUNUHSUMCdatasets.NeuroImage.of clusterwise true positive rates in periventricular and deep region for LOCATE and global thresholding.true positive ates in periventricular and deep regions shown for NDGENOXVASC and MWSC datasets

NeuroImage methods achieved.LOCATE gives better clusterwise TPR when compared to global threshold and the third ranking method in the challenge.direct comparison would not be possible since the results of the top ranking methods were determined on the independent test datasetswhile our results were obtained on leaveoneout validation on the MWSC training datasets that are publicly available.we retained the regions corresponding to other pathologies for more stringent evaluationwhile these regionswere ignored during evaluation in the MICCAI challenge.validation of LOCATE on CADASIL and HC datasets proves that LOCATE is robust with respect to variations in lesion load and location without the need to retrain both BIANCA and LOCATE.factLOCATE can be trained on any data having the same modalitiesacquired with the same sequence to the test dataset.instancewe used the OXVASC dataset to train LOCATE for testing it on the CADASIL dataset since both datasets were acquired with the same sequences.pattern of lesionsTablestatistics and ANOVA results for comparison of clusterwise TPR values for global threshold of.NDGEN OXVASC VUNUHSUMCstatisticsregion LOCATE.results of LOCATE on the CADASIL data.FLAIR imageglobal thresholding at.that the threshold maps shows the heterogeneity in the lesion proba bilities in various regions of the white matter.NeuroImage CADASIL subjects differs from that of vascular subjects in the OXVASC datasetas CADASIL subjectsin addition to the normal distri bution of WMH seen in SVDwill typically have lesions within the external capsule and anterior temporal lobes.to this variability in lesion characteristics and patterntraining BIANCA on the OXVASC dataset yields very low lesion probabilities in the tem poral regions.ecting these lower lesion probabilitiesthe thresholds map from LOCATE shows much lower threshold valuesespe cially in the temporal regions in the CADASIL images.LOCATE yields much better segmentation performance compared to global threshold of.LOCATE results on CADASIL showed substantial increase of.indicates that LOCATE takes into account different lesion patterns and hence can be used in different pa thologies.compared with the approaches proposed byet al.LOCATE overcomes the need for manually determining thresh olds for individual subjects on the CADASIL datasetwhile still providing similar SI values and comparable limits of agreement with the gold standard on BlandAltman plot

versuset al.threshold maps obtained from LOCATE for the HC dataset showhigher thresholds when compared with the CADASIL dataset.is due to the fact that HC have mostly periventricular lesionsthat are common in healthy ageingthat are usually assigned higher probabilities.by using higher threshold valuesLOCATE gives results that appear visually similar to the global thresholding at.the threshold maps from LOCATE.and provide information regarding the spatial heterogeneity of lesion probabilitiesboxplots of thresholds shown in.show the overall characteristics of the datasets.improvement in segmentation per formance is more prominent in the OXVASC and CADASIL datasets when compared to the NDGENMWSC and HC datasets.is reected in their corresponding optimal global thresholds being very different fromthe median of their LOCATE thresholds.LOCATE results on theve datasetsespecially the HC datasetwhich has negligible lesion load compared with the CADASIL subjectsshow that LOCATE is more adaptive to the variation in the global lesion load in addition to the spatial heterogeneity in lesion probabilitiescompared to global thresh olding.the number of subjects needed for trainingwe used minimal training set of subjects from OXVASC to get good perfor mance on both OXVASC and CADASIL.we would recommend using subjects for training LOCATE.it is worth noting that the number of training subjects.results of LOCATE on the HC data.FLAIR imageglobal thresholding at.that the threshold maps shows the heterogeneity in the lesions probabilities in various regions of white mat ter.NeuroImage to achieve good results can vary across datasetsfor more details on the optimal number of training subjectsrefer toet al.this reasonwe advise checking the segmentation accuracy on each datasetcomparing the output with the manual masks whenever avail able andif neededincreasing the number of subjects included in the training or consider retraining on the specic dataset.farevaluation of LOCATE has been performed on relatively small datasetscontaining subjectswhich limits the power of our results.the experi ments done so far show that LOCATE is generalizable when trained with datasetspecic images or when using training dataset generated with images acquired with the same scanner and sequences

are currentlyworking towards improving robustness across scanners and sequences.its currentimplementationLOCATE running time to determine binary lesion map from an individual lesion probability map is approx imately min per subjectwhen run on an iMac with.LOCATE will be included as an additional option for generating bi nary lesion mapsas an alternative to the fasterbut less accurateglobal thresholdingin future release of BIANCA.uk/fsl/fslwiki/BIANCAunder postprocessing sec tion for more details).BlandAltman plot of WMH volumes on results obtained from reference segmentation and global thresholding and reference segmentation and LOCATE.of local thresholds obtained from the random forest regression model in LOCATE.optimal global thresholds determined manually are show ni red circles.mean values of local thresholds obtained from LOCATE are shown in black circles.NeuroImage potential future development of LOCATE could be to use the esti mated thresholds to normalise the lesion probabilities locally in order to obtain more uniform lesion probability map that is robust to the diffuse nature of the lesions in different areas of the brain.interesting future direction for BIANCA could be to investigate the amount and distribution of lesions in various cerebral lobessimilar to our analysis of lesions in periventricular and deep regions.various deep learning networks have been shown to perform better than the conventional machine learning based classiers for similar problems.in future workwe will explore various convolutional neural network models for more accurate segmentation of WMH.work was supported by theandandgrant number.is funded by thefortheand thesprogramme.foris supported by core funding from the.PMR is in receipt of NIHRtigator award.views expressed are those of the author and not necessarily those of the NHSthe NIHR or theof.VS is supported by theforof.CLH was funded bysity ofinofandaward.MH was funded by grant from theand the NIHR

MJ and GZ are supported by thefor.LG is supported by thecoveryfromUK the MRCUK and thefor.acknowledge all the participants.are grateful to.and all the staff of NDGEN.acknowledgeand.for their help in recruiting the CADASIL cohort.acknowledge the use of the facilities of the.for their help on generating the manual masks used in our experiments.receives royalties from licensing of FSL to nonacademiccom mercial parties.authors report no potential conicts of interest.